# 🤖 汇享易报告自助生成智能体 - 项目说明

## 📌 项目概述

本项目是一个基于Python + Gradio的自动化报告生成系统，可以从Excel文件中自动提取信访数据，智能计算本周/上周统计信息，并生成标准格式的Word报告。

## 🎯 核心功能

1. **Excel数据解析**
   - 支持.xls和.xlsx格式
   - 支持密码保护的Excel文件（默认密码：110110）
   - 自动读取"阳光xf登记"和"gab上访"两个sheet
   - 解析B列的登记时间（月.日格式）

2. **智能日期计算**
   - 自动识别本周范围（周一到周日）
   - 自动识别上周范围（上周一到上周日）
   - 精准筛选符合时间范围的数据

3. **数据统计**
   - 本周阳光xf登记人数
   - 上周阳光xf登记人数
   - 本周gab上访人数
   - 上周gab上访人数
   - 本周总人数（两个sheet合计）
   - 自动计算环比趋势（上升/下降/持平）

4. **Word报告生成**
   - 基于模板自动填充数据
   - 保持原有格式和样式
   - 自动替换占位符
   - 支持自定义输出文件名

5. **友好的Web界面**
   - 基于Gradio构建
   - 简洁直观的操作界面
   - 实时显示处理状态
   - 一键下载生成的报告

## 📂 项目结构

```
reportgene/
├── app.py                          # 主应用程序（Gradio界面）
├── excel_parser.py                 # Excel解析模块
├── date_calculator.py              # 日期计算模块
├── word_generator.py               # Word生成模块
├── template.docx                   # Word模板文件
├── requirements.txt                # Python依赖包
├── start.sh                        # 启动脚本
├── README.md                       # 项目说明
├── 使用手册.md                     # 详细使用手册
├── test_integration.py             # 集成测试脚本
├── output/                         # 生成的报告输出目录
│   ├── 集成测试报告.docx
│   └── 测试报告.docx
├── 2025年复盘人员明细9.22.xls    # 示例数据文件
└── venv/                           # Python虚拟环境
```

## 🔧 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Python | 3.8+ | 主要开发语言 |
| Gradio | 4.44.0 | Web界面框架 |
| Pandas | 2.2.2 | 数据处理 |
| openpyxl | 3.1.5 | Excel文件处理(.xlsx) |
| xlrd | 2.0.1 | Excel文件处理(.xls) |
| python-docx | 1.1.2 | Word文档生成 |
| msoffcrypto-tool | 5.4.2 | Excel文件解密 |

## 🚀 快速开始

### 1. 安装依赖

```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 2. 启动应用

```bash
# 使用启动脚本
./start.sh

# 或直接运行
python app.py
```

### 3. 访问系统

在浏览器中打开：http://localhost:7860

## 📊 数据流程

```
用户上传Excel
    ↓
解密文件（如有密码）
    ↓
读取两个sheet数据
    ↓
解析B列登记时间（月.日 → 完整日期）
    ↓
计算本周/上周范围
    ↓
筛选符合范围的数据并计数
    ↓
计算环比趋势
    ↓
读取Word模板
    ↓
替换占位符
    ↓
生成Word报告
    ↓
用户下载报告
```

## 🔐 Excel文件密码

- 默认密码：`110110`
- 系统支持密码保护的Excel文件
- 如无密码，可清空密码输入框

## 📝 Word模板占位符

模板中使用以下占位符：

| 占位符 | 说明 |
|--------|------|
| `{{total_count}}` | 本周总人数（阳光xf+gab） |
| `{{sunshine_count}}` | 本周阳光xf登记人数 |
| `{{last_week_sunshine}}` | 上周阳光xf登记人数 |
| `{{sunshine_trend}}` | 阳光xf环比趋势 |
| `{{gab_count}}` | 本周gab上访人数 |
| `{{last_week_gab}}` | 上周gab上访人数 |
| `{{gab_trend}}` | gab上访环比趋势 |

## ✅ 测试验证

运行集成测试：

```bash
source venv/bin/activate
python test_integration.py
```

测试内容：
- ✅ 文件检查
- ✅ Excel解析
- ✅ 数据统计
- ✅ Word生成
- ✅ 文件验证

## 📋 使用说明

### Excel文件要求

1. **必须包含两个sheet**：
   - `阳光xf登记`
   - `gab上访`

2. **列结构**：
   - A列：序号
   - B列：登记时间（格式：月.日）

3. **时间格式示例**：
   - 1.2 → 2025-01-02
   - 2.17 → 2025-02-17
   - 12.25 → 2025-12-25

### 操作步骤

1. 上传Excel文件
2. 输入密码（如需要）
3. 设置输出文件名
4. 点击"开始生成"
5. 下载生成的报告

## 🐛 常见问题

### 1. Excel解析失败
- 检查sheet名称是否正确
- 确认B列是否为登记时间
- 验证密码是否正确

### 2. 统计人数为0
- 检查数据日期是否在本周/上周范围内
- 查看系统显示的日期范围

### 3. Word无法生成
- 确认template.docx存在
- 检查output目录是否有写权限

## 📈 后续优化方向

1. **功能增强**
   - 支持更多统计维度
   - 添加数据可视化图表
   - 支持批量处理多个Excel

2. **性能优化**
   - 大文件处理优化
   - 缓存机制
   - 并发处理

3. **用户体验**
   - 添加数据预览功能
   - 提供模板自定义
   - 支持多种报告格式

## 📞 技术支持

遇到问题请检查：
1. Python版本 >= 3.8
2. 依赖包完整安装
3. Excel文件格式正确
4. 查看终端错误输出

## 📄 许可说明

本项目仅供内部使用。

---

**开发完成日期**：2025-10-14  
**系统版本**：v1.0.0  
**开发者**：Claude (Anthropic)


